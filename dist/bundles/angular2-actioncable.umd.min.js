!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@rails/actioncable")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@rails/actioncable"],e):e(t["angular2-actioncable"]={},t.ng.core,t["@rails/actioncable"])}(this,function(t,e,r){"use strict";var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function c(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function a(t){return"function"==typeof t}var i=!1,o={Promise:undefined,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack,i=t},get useDeprecatedSynchronousErrorHandling(){return i}};function u(t){setTimeout(function(){throw t},0)}var h={closed:!0,next:function(t){},error:function(t){if(o.useDeprecatedSynchronousErrorHandling)throw t;u(t)},complete:function(){}},l=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}();function p(t){return null!==t&&"object"==typeof t}var d=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),s=function(){function h(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}var t;return h.prototype.unsubscribe=function(){var t;if(!this.closed){var e=this._parentOrParents,r=this._ctorUnsubscribe,n=this._unsubscribe,i=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,e instanceof h)e.remove(this);else if(null!==e)for(var o=0;o<e.length;++o)e[o].remove(this);if(a(n)){r&&(this._unsubscribe=undefined);try{n.call(this)}catch(u){t=u instanceof d?b(u.errors):[u]}}if(l(i))for(var o=-1,s=i.length;++o<s;){var c=i[o];if(p(c))try{c.unsubscribe()}catch(u){t=t||[],u instanceof d?t=t.concat(b(u.errors)):t.push(u)}}if(t)throw new d(t)}},h.prototype.add=function(t){var e,r=t;if(!t)return h.EMPTY;switch(typeof t){case"function":r=new h(t);case"object":if(r===this||r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;r instanceof h||(e=r,(r=new h)._subscriptions=[e]);break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var n=r._parentOrParents;if(null===n)r._parentOrParents=this;else if(n instanceof h){if(n===this)return r;r._parentOrParents=[n,this]}else{if(-1!==n.indexOf(this))return r;n.push(this)}n=this._subscriptions;return null===n?this._subscriptions=[r]:n.push(r),r},h.prototype.remove=function(t){var e=this._subscriptions;!e||-1!==(t=e.indexOf(t))&&e.splice(t,1)},h.EMPTY=((t=new h).closed=!0,t),h}();function b(t){return t.reduce(function(t,e){return t.concat(e instanceof d?e.errors:e)},[])}var f=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),y=function(i){function o(t,e,r){var n=i.call(this)||this;switch(n.syncErrorValue=null,n.syncErrorThrown=!1,n.syncErrorThrowable=!1,n.isStopped=!1,arguments.length){case 0:n.destination=h;break;case 1:if(!t){n.destination=h;break}if("object"==typeof t){t instanceof o?(n.syncErrorThrowable=t.syncErrorThrowable,(n.destination=t).add(n)):(n.syncErrorThrowable=!0,n.destination=new v(n,t));break}default:n.syncErrorThrowable=!0,n.destination=new v(n,t,e,r)}return n}return c(o,i),o.prototype[f]=function(){return this},o.create=function(t,e,r){r=new o(t,e,r);return r.syncErrorThrowable=!1,r},o.prototype.next=function(t){this.isStopped||this._next(t)},o.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},o.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},o.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,i.prototype.unsubscribe.call(this))},o.prototype._next=function(t){this.destination.next(t)},o.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},o.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},o.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},o}(s),v=function(s){function t(t,e,r,n){var i,o=s.call(this)||this;o._parentSubscriber=t;t=o;return a(e)?i=e:e&&(i=e.next,r=e.error,n=e.complete,e!==h&&(a((t=Object.create(e)).unsubscribe)&&o.add(t.unsubscribe.bind(t)),t.unsubscribe=o.unsubscribe.bind(o))),o._context=t,o._next=i,o._error=r,o._complete=n,o}return c(t,s),t.prototype.next=function(t){var e;!this.isStopped&&this._next&&(e=this._parentSubscriber,o.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t))},t.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,r=o.useDeprecatedSynchronousErrorHandling;if(this._error)r&&e.syncErrorThrowable?this.__tryOrSetError(e,this._error,t):this.__tryOrUnsub(this._error,t),this.unsubscribe();else if(e.syncErrorThrowable)r?(e.syncErrorValue=t,e.syncErrorThrown=!0):u(t),this.unsubscribe();else{if(this.unsubscribe(),r)throw t;u(t)}}},t.prototype.complete=function(){var t,e,r=this;this.isStopped||(t=this._parentSubscriber,this._complete&&(e=function(){return r._complete.call(r._context)},o.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,e):this.__tryOrUnsub(e)),this.unsubscribe())},t.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(r){if(this.unsubscribe(),o.useDeprecatedSynchronousErrorHandling)throw r;u(r)}},t.prototype.__tryOrSetError=function(t,e,r){if(!o.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,r)}catch(n){return o.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=n,t.syncErrorThrown=!0):(u(n),!0)}return!1},t.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},t}(y);var w=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function _(t){return t}var S=function(){function r(t){this._isScalar=!1,t&&(this._subscribe=t)}return r.prototype.lift=function(t){var e=new r;return e.source=this,e.operator=t,e},r.prototype.subscribe=function(t,e,r){var n=this.operator,r=function(t,e,r){if(t){if(t instanceof y)return t;if(t[f])return t[f]()}return t||e||r?new y(t,e,r):new y(h)}(t,e,r);if(n?r.add(n.call(r,this.source)):r.add(this.source||o.useDeprecatedSynchronousErrorHandling&&!r.syncErrorThrowable?this._subscribe(r):this._trySubscribe(r)),o.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable&&(r.syncErrorThrowable=!1,r.syncErrorThrown))throw r.syncErrorValue;return r},r.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){o.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),!function(t){for(;t;){var e=t.closed,r=t.destination,n=t.isStopped;if(e||n)return;t=r&&r instanceof y?r:null}return 1}(t)?console.warn(e):t.error(e)}},r.prototype.forEach=function(i,t){var e=this;return new(t=E(t))(function(t,r){var n=e.subscribe(function(t){try{i(t)}catch(e){r(e),n&&n.unsubscribe()}},r,t)})},r.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},r.prototype[w]=function(){return this},r.prototype.pipe=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return 0===t.length?this:(0===(e=t).length?_:1===e.length?e[0]:function(t){return e.reduce(function(t,e){return e(t)},t)})(this)},r.prototype.toPromise=function(t){var n=this;return new(t=E(t))(function(t,e){var r;n.subscribe(function(t){return r=t},function(t){return e(t)},function(){return t(r)})})},r.create=function(t){return new r(t)},r}();function E(t){if(!(t=t||(o.Promise||Promise)))throw new Error("no Promise impl found");return t}var m=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),g=function(n){function t(t,e){var r=n.call(this)||this;return r.subject=t,r.subscriber=e,r.closed=!1,r}return c(t,n),t.prototype.unsubscribe=function(){var t,e;this.closed||(this.closed=!0,t=(e=this.subject).observers,this.subject=null,!t||0===t.length||e.isStopped||e.closed||-1!==(e=t.indexOf(this.subscriber))&&t.splice(e,1))},t}(s),x=function(r){function t(t){var e=r.call(this,t)||this;return e.destination=t,e}return c(t,r),t}(y),O=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return c(t,e),t.prototype[f]=function(){return new x(this)},t.prototype.lift=function(t){var e=new T(this,this);return e.operator=t,e},t.prototype.next=function(t){if(this.closed)throw new m;if(!this.isStopped)for(var e=this.observers,r=e.length,n=e.slice(),i=0;i<r;i++)n[i].next(t)},t.prototype.error=function(t){if(this.closed)throw new m;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,r=e.length,n=e.slice(),i=0;i<r;i++)n[i].error(t);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new m;this.isStopped=!0;for(var t=this.observers,e=t.length,r=t.slice(),n=0;n<e;n++)r[n].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new m;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(t){if(this.closed)throw new m;return this.hasError?(t.error(this.thrownError),s.EMPTY):this.isStopped?(t.complete(),s.EMPTY):(this.observers.push(t),new g(this,t))},t.prototype.asObservable=function(){var t=new S;return t.source=this,t},t.create=function(t,e){return new T(t,e)},t}(S),T=function(n){function t(t,e){var r=n.call(this)||this;return r.destination=t,r.source=e,r}return c(t,n),t.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},t.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},t.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},t.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):s.EMPTY},t}(O);var j=function(n){function t(t,e){var r=n.call(this,t,e)||this;return r.scheduler=t,r.work=e,r.pending=!1,r}return c(t,n),t.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t;var r=this.id,t=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(t,r,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(t,this.id,e),this},t.prototype.requestAsyncId=function(t,e,r){return void 0===r&&(r=0),setInterval(t.flush.bind(t,this),r)},t.prototype.recycleAsyncId=function(t,e,r){return null!==(r=void 0===r?0:r)&&this.delay===r&&!1===this.pending?e:(clearInterval(e),undefined)},t.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;e=this._execute(t,e);if(e)return e;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(t,e){var r=!1,n=undefined;try{this.work(t)}catch(i){r=!0,n=!!i&&i||new Error(i)}if(r)return this.unsubscribe(),n},t.prototype._unsubscribe=function(){var t=this.id,e=this.scheduler,r=e.actions,n=r.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==n&&r.splice(n,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null},t}(function(r){function t(t,e){return r.call(this)||this}return c(t,r),t.prototype.schedule=function(t,e){return void 0===e&&(e=0),this},t}(s)),P=function(){function r(t,e){void 0===e&&(e=r.now),this.SchedulerAction=t,this.now=e}return r.prototype.schedule=function(t,e,r){return void 0===e&&(e=0),new this.SchedulerAction(this,t).schedule(r,e)},r.now=function(){return Date.now()},r}(),D=function(n){function i(t,e){void 0===e&&(e=P.now);var r=n.call(this,t,function(){return i.delegate&&i.delegate!==r?i.delegate.now():e()})||this;return r.actions=[],r.active=!1,r.scheduled=undefined,r}return c(i,n),i.prototype.schedule=function(t,e,r){return void 0===e&&(e=0),i.delegate&&i.delegate!==this?i.delegate.schedule(t,e,r):n.prototype.schedule.call(this,t,e,r)},i.prototype.flush=function(t){var e,r=this.actions;if(this.active)r.push(t);else{this.active=!0;do{if(e=t.execute(t.state,t.delay))break}while(t=r.shift());if(this.active=!1,e){for(;t=r.shift();)t.unsubscribe();throw e}}},i}(P);var C=new D(j);var U=function(){function t(t,e){this.dueTime=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new A(t,this.dueTime,this.scheduler))},t}(),A=function(n){function t(t,e,r){t=n.call(this,t)||this;return t.dueTime=e,t.scheduler=r,t.debouncedSubscription=null,t.lastValue=null,t.hasValue=!1,t}return c(t,n),t.prototype._next=function(t){this.clearDebounce(),this.lastValue=t,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(V,this.dueTime,this))},t.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},t.prototype.debouncedNext=function(){var t;this.clearDebounce(),this.hasValue&&(t=this.lastValue,this.lastValue=null,this.hasValue=!1,this.destination.next(t))},t.prototype.clearDebounce=function(){var t=this.debouncedSubscription;null!==t&&(this.remove(t),t.unsubscribe(),this.debouncedSubscription=null)},t}(y);function V(t){t.debouncedNext()}var H=r,k=(I.prototype.channel=function(t,e){var r=this,e=new M(this,t,e=void 0===e?{}:e);return e.disconnected().subscribe(function(t){return r.disconnectedSource.next(t)}),e},I.prototype.disconnected=function(){return this.disconnectedSource.asObservable().pipe((e=100,void 0===r&&(r=C),function(t){return t.lift(new U(e,r))}));var e,r},I.prototype.disconnect=function(){this.baseCable.disconnect()},I.prototype.buildUrl=function(t,e){return(e=e instanceof Function?e():e)?[t,Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")].join("?"):t},I);function I(t,e){var r=this;this.url=t,this.params=e,this.disconnectedSource=new O,this.baseCable=H.createConsumer(this.buildUrl(t,e)),e instanceof Function&&this.disconnected().subscribe(function(){r.baseCable.url=H.createWebSocketURL(r.buildUrl(t,e))})}var M=(z.prototype.received=function(){return this.messages},z.prototype.initialized=function(){return this.initializedSource.asObservable()},z.prototype.connected=function(){return this.connectedSource.asObservable()},z.prototype.disconnected=function(){return this.disconnectedSource.asObservable()},z.prototype.rejected=function(){return this.rejectedSource.asObservable()},z.prototype.send=function(t){this.baseChannel.send(t)},z.prototype.perform=function(t,e){this.baseChannel.perform(t,e)},z.prototype.unsubscribe=function(){var e=this;this.baseChannel.unsubscribe(),this.eventTypes.forEach(function(t){return e[t+"Source"].complete()})},z);function z(t,e,r){void 0===r&&(r={});var n=this;this.cable=t,this.name=e,this.params=r,this.initializedSource=new O,this.connectedSource=new O,this.disconnectedSource=new O,this.rejectedSource=new O,this.eventTypes=["initialized","connected","disconnected","rejected"];var i=Object.assign({},r,{channel:e});this.messages=new S(function(e){var t={received:function(t){return e.next(t)}};return n.eventTypes.forEach(function(e){t[e]=function(t){return n[e+"Source"].next(t)}}),n.baseChannel=n.cable.baseCable.subscriptions.create(i,t),function(){return n.unsubscribe()}})}Y.prototype.cable=function(t,e){return this.cables.hasOwnProperty(t)||(this.cables[t]=new k(t,e)),this.cables[t]},Y.prototype.disconnect=function(t){this.cables.hasOwnProperty(t)&&(this.cables[t].disconnect(),delete this.cables[t])},r=Y;function Y(){this.cables={}}r.decorators=[{type:e.Injectable}],r.ctorParameters=function(){return[]},t.Cable=k,t.Channel=M,t.ActionCableService=r,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=angular2-actioncable.umd.min.js.map
